# Image Inspector (CustomTkinter)

Небольшое настольное приложение на CustomTkinter для просмотра изображений с отображением:
- размера изображения,
- пути и размера файла,
- режима (RGB/RGBA/…),
- координат курсора,
- значения пикселя под курсором (RGBA и HEX),
- управления масштабом (зум).

## Установка

Рекомендуется использовать Python 3.11+.

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

## Запуск

```bash
python -m app.main
```

## Структура

```
app/
  app.py                # создание окна и сборка UI
  main.py               # точка входа
  controllers/
    app_controller.py   # соединяет сервисы и UI
  models/
    image_model.py      # модель данных изображения
  services/
    image_service.py    # загрузка изображений и метаданные
  ui/
    image_viewer.py     # канвас с отображением и зумом, трекинг курсора
    sidebar.py          # панель с кнопками/слайдером/инфо
```

## Горячие моменты UX

- Зум: слайдер справа (10%–400%). По умолчанию — подгонка под окно (Fit).
- Отображение пикселя: наведи курсор на изображение, в сайдбаре обновятся координаты и цвет (RGBA/HEX).

## Сравнение «До/После»

- Обработка (демо): выберите в сайдбаре «Обработка → Оттенки серого».
- Режимы сравнения:
  - «Нет» — обычный вид.
  - «Шторка» — плавная граница: позиция регулируется слайдером ниже.
  - «2-up» — два изображения рядом (до/после), общий зум и панорамирование.
- Удерживайте пробел — временно показать «До» (в режимах «Нет» и «Шторка»).

## Сегментация (п.1 — 2.3)

Выберите режим в сайдбаре (раздел «Обработка», теперь с вкладками):
- «Края (Собель)»: выделение границ через оператор Собеля с последующим порогованием по Отсу.
- «Порог (P-tile)»: глобальный порог T так, чтобы доля пикселей ярче T равнялась P (по умолчанию P=0.3).
- «Порог (итеративный)»: метод последовательных приближений (ISODATA).
- «K‑средних (k=2|3|4)»: сегментация по интенсивности через k‑means; изображение постеризуется по центроидам.
- «K‑средних сравнение (2,3,4)»: горизонтальная склейка результатов для разных k для наглядного сравнения.
- «Порог (адаптивный)»: локальный порог по окрестности (среднее/медиана/(min+max)/2) с параметрами k, C, T.
- «Адаптивный сравнение (k|C|T)»: коллажи для сравнения влияния размера окна, коэффициента C и смещения T.

### Настраиваемые параметры в UI
- Вкладка «Пороговые»:
  - P‑tile: слайдер P (0–100%), по умолчанию 30%.
  - Итеративный: толщина сходимости `tol` (0.1–5.0) и `max_iter` (целое).
  - Адаптивный порог:
    - `k` — размер окна (нечётный, 3–51),
    - `C` — коэффициент масштаба локальной статистики (0.0–2.0),
    - `T` — аддитивное смещение порога (−50…50),
    - статистика по окрестности: «Среднее», «Медиана», «Полудиапазон (min+max)/2».
    - Режимы сравнения: списки для k / C / T (через запятую), строятся коллажи с подписями.
- Вкладка «K‑средних»:
  - Одиночный режим: `k` (2–8) и `max_iter` (целое).
  - Сравнение: список `k` через запятую (например, `2,3,4`).

### Краткое объяснение алгоритмов
- 1) Выделение краёв (Собель + Отсу):
  - Считаем градиенты Gx, Gy (ядра Собеля), модуль градиента M = sqrt(Gx^2 + Gy^2).
  - На M применяем метод Отсу для выбора порога, пиксели выше порога — границы.
- 2.1) P‑tile:
  - По гистограмме яркостей подбираем порог T так, чтобы доля пикселей с I≥T равнялась заданной площади P.
  - Предполагается, что объект светлее фона.
- 2.2) Последовательные приближения:
  - Инициализация T0 средним яркости; далее итеративно T' = (μ1 + μ2)/2, где μ1 — средняя яркость пикселей ≤T, μ2 — >T.
  - Итерации до сходимости (малая разница порогов).
- 2.3) K‑средних:
  - Кластеризация интенсивностей (0..255) на k кластеров, центроиды — средние по кластерам.
  - Итоговое изображение — постеризация по центроидам; для k=2 получается бинарная сегментация.
- 3) Порог с адаптивным порогом:
  - Для каждого пикселя вычисляется локальная статистика по окну k×k: `S_k` — среднее, медиана или `(min+max)/2`.
  - Пороговая функция: `I(x,y) >= C · S_k(x,y) + T` (для светлого объекта на более тёмном фоне).
  - Параметры:
    - `k` — размер окна (чем больше, тем «глобальнее» оценка),
    - `C` — масштаб влияния локальной статистики,
    - `T` — аддитивная поправка (сдвиг) к порогу.
  - В режиме сравнения можно оценить влияние каждого параметра (k, C, T) на результат.

## Заметки

- Поддерживаются популярные форматы (PNG, JPG, JPEG, BMP, GIF и т.п.), зависит от Pillow.
- Для больших изображений зум >100% может выходить за границы области просмотра (без прокрутки). Это сделано намеренно ради простоты.

## Нижняя панель

- Масштаб теперь управляется снизу: слайдер + пресеты `25%/50%/100%/200%/400%` и `Fit`.
- Сравнение и «Позиция шторки» находятся там же. Обработка («Оттенки серого») — в сайдбаре.


